# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –Ø–Ω–¥–µ–∫—Å –£–º–Ω—ã–º –î–æ–º–æ–º

## üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~1,735 —Å—Ç—Ä–æ–∫ (–ø–ª–∞–≥–∏–Ω—ã –Ø–Ω–¥–µ–∫—Å)
- **–ü–ª–∞–≥–∏–Ω–æ–≤**: 2 (oauth_yandex, yandex_smart_home)
- **–ú–æ–¥—É–ª–µ–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é**: 3 (admin, devices, api)
- **HTTP endpoints**: 7
- **–°–µ—Ä–≤–∏—Å–æ–≤**: 12
- **–°–æ–±—ã—Ç–∏–π**: 3

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Core Runtime                              ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ  oauth_yandex     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ yandex_smart_home ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ   (–ø–ª–∞–≥–∏–Ω)        ‚îÇ      ‚îÇ    (–ø–ª–∞–≥–∏–Ω)       ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ         ‚îÇ                            ‚îÇ                      ‚îÇ
‚îÇ         ‚îÇ                            ‚îÇ                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ  ‚îÇ      Service Registry                    ‚îÇ              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ         ‚îÇ                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ AdminModule ‚îÇ  ‚îÇ DevicesModule‚îÇ  ‚îÇ  ApiModule   ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ         ‚îÇ                  ‚îÇ                  ‚îÇ           ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                            ‚îÇ                              ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
‚îÇ                    ‚îÇ  Event Bus     ‚îÇ                     ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
                    –Ø–Ω–¥–µ–∫—Å IoT API
```

---

## üîå –ü–ª–∞–≥–∏–Ω—ã

### 1. `oauth_yandex` (OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ OAuth flow –¥–ª—è –Ø–Ω–¥–µ–∫—Å

**–†–∞–∑–º–µ—Ä**: ~343 —Å—Ç—Ä–æ–∫–∏

**–°–µ—Ä–≤–∏—Å—ã**:
- `oauth_yandex.configure` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `oauth_yandex.get_status` - —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `oauth_yandex.get_authorize_url` - –ø–æ–ª—É—á–µ–Ω–∏–µ URL –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `oauth_yandex.exchange_code` - –æ–±–º–µ–Ω –∫–æ–¥–∞ –Ω–∞ —Ç–æ–∫–µ–Ω—ã
- `oauth_yandex.get_tokens` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (internal)
- `oauth_yandex.validate_token` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞
- `oauth_yandex.set_tokens` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ (test)

**HTTP Endpoints**:
- `POST /oauth/yandex/configure`
- `GET /oauth/yandex/status`
- `GET /oauth/yandex/authorize-url`
- `POST /oauth/yandex/exchange-code`
- `GET /oauth/yandex/validate`

**–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**:
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `storage["oauth_yandex"]["config"]`
- –¢–æ–∫–µ–Ω—ã: `storage["oauth_yandex"]["tokens"]`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- Self-contained (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–ª–∞–≥–∏–Ω–æ–≤)
- –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ HTTP (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ internal service)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

### 2. `yandex_smart_home` (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –Ø–Ω–¥–µ–∫—Å –£–º–Ω–æ–≥–æ –î–æ–º–∞

**–†–∞–∑–º–µ—Ä**: ~1,392 —Å—Ç—Ä–æ–∫–∏ (–ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: `oauth_yandex`

**–ú–æ–¥—É–ª–∏**:
- `api_client.py` (222 —Å—Ç—Ä–æ–∫–∏) - —Ä–∞–±–æ—Ç–∞ —Å –Ø–Ω–¥–µ–∫—Å API
- `device_transformer.py` (222 —Å—Ç—Ä–æ–∫–∏) - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `device_sync.py` (102 —Å—Ç—Ä–æ–∫–∏) - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `device_status.py` (215 —Å—Ç—Ä–æ–∫) - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
- `command_handler.py` (441 —Å—Ç—Ä–æ–∫–∞) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
- `plugin.py` (178 —Å—Ç—Ä–æ–∫) - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø–ª–∞–≥–∏–Ω–∞

**–°–µ—Ä–≤–∏—Å—ã**:
- `yandex.sync_devices` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ API
- `yandex.check_devices_online` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞

**–°–æ–±—ã—Ç–∏—è**:
- –ü—É–±–ª–∏–∫—É–µ—Ç: `external.device_discovered`
- –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è: `internal.device_command_requested`

**API Endpoints** (—á–µ—Ä–µ–∑ AdminModule):
- `POST /admin/v1/yandex/sync`
- `POST /admin/v1/yandex/check-online`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ `oauth_yandex.get_tokens()` (–Ω–µ —Ö—Ä–∞–Ω–∏—Ç)
- Feature flag: `yandex.use_real_api` –≤ storage
- –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- Background polling –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å pending –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## üì° –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤

```
User ‚Üí AdminModule ‚Üí yandex.sync_devices
                      ‚Üì
              YandexAPIClient.get_user_info()
                      ‚Üì
              –Ø–Ω–¥–µ–∫—Å IoT API
                      ‚Üì
              DeviceTransformer.transform_device()
                      ‚Üì
              Event Bus: external.device_discovered
                      ‚Üì
              DevicesModule.handle_external_device_discovered()
                      ‚Üì
              Storage: devices_external
```

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º

```
User ‚Üí AdminModule ‚Üí devices.set_state
                      ‚Üì
              Event Bus: internal.device_command_requested
                      ‚Üì
              CommandHandler.handle_command()
                      ‚Üì
              YandexAPIClient.send_device_action()
                      ‚Üì
              –Ø–Ω–¥–µ–∫—Å IoT API
                      ‚Üì
              –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                      ‚Üì
              Background polling
                      ‚Üì
              Event Bus: external.device_state_reported
                      ‚Üì
              DevicesModule.handle_external_state()
                      ‚Üì
              Storage: devices (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è)
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞

```
User ‚Üí AdminModule ‚Üí yandex.check_devices_online
                      ‚Üì
              DeviceStatusChecker.check_devices_online()
                      ‚Üì
              –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                      ‚Üì
              –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ last_seen –∏ online —Å—Ç–∞—Ç—É—Å–∞
                      ‚Üì
              Storage: devices
```

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–¥—É–ª—è–º–∏

### AdminModule

**–†–æ–ª—å**: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç HTTP endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ø–Ω–¥–µ–∫—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

**Endpoints**:
- `POST /admin/v1/yandex/sync` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `POST /admin/v1/yandex/check-online` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- Wrapper-—Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

### DevicesModule

**–†–æ–ª—å**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –∏ –º–∞–ø–ø–∏–Ω–≥–∞–º–∏

**–°–µ—Ä–≤–∏—Å—ã**:
- `devices.list` - —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `devices.get` - –ø–æ–ª—É—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `devices.set_state` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–ø—É–±–ª–∏–∫—É–µ—Ç `internal.device_command_requested`)
- `devices.list_mappings` - —Å–ø–∏—Å–æ–∫ –º–∞–ø–ø–∏–Ω–≥–æ–≤
- `devices.create_mapping` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π**:
- `external.device_discovered` ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `external.device_state_reported` ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**–•—Ä–∞–Ω–µ–Ω–∏–µ**:
- `devices` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `devices_external` - –≤–Ω–µ—à–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `devices_mappings` - –º–∞–ø–ø–∏–Ω–≥–∏ external_id ‚Üí internal_id

### ApiModule

**–†–æ–ª—å**: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–∏—Å–∞–º

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è `oauth_yandex.configure` –∏ `oauth_yandex.exchange_code`
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `authz.py`

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### OAuth Flow

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: `POST /oauth/yandex/configure` (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç client_id, client_secret)
2. **–ü–æ–ª—É—á–µ–Ω–∏–µ URL**: `GET /oauth/yandex/authorize-url`
3. **–†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –Ω–∞ –Ø–Ω–¥–µ–∫—Å
4. **–û–±–º–µ–Ω –∫–æ–¥–∞**: `POST /oauth/yandex/exchange-code`
5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤**: —á–µ—Ä–µ–∑ `oauth_yandex.get_tokens()` (internal)

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (authz.py)

- `oauth.read` - —á—Ç–µ–Ω–∏–µ OAuth —Å—Ç–∞—Ç—É—Å–∞
- `oauth.write` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth –∏ –æ–±–º–µ–Ω –∫–æ–¥–∞
- `devices.read` - —á—Ç–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `devices.write` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- `oauth_yandex.*` —Å–µ—Ä–≤–∏—Å—ã –∏–º–µ—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ authz
- –¢–æ–∫–µ–Ω—ã –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ HTTP endpoints
- –¢–æ–ª—å–∫–æ internal —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω—ã

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞

### –ü–æ –º–æ–¥—É–ª—è–º

| –ú–æ–¥—É–ª—å | –°—Ç—Ä–æ–∫ | –§–∞–π–ª–æ–≤ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-------|--------|------------|
| `oauth_yandex` | 343 | 1 | OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| `yandex_smart_home` | 1,392 | 6 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ |
| **–ò—Ç–æ–≥–æ –ø–ª–∞–≥–∏–Ω—ã** | **1,735** | **7** | |
| `AdminModule` (yandex —á–∞—Å—Ç—å) | ~50 | 1 | HTTP endpoints |
| `DevicesModule` (yandex —á–∞—Å—Ç—å) | ~200 | 2 | –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ |
| `ApiModule` (yandex —á–∞—Å—Ç—å) | ~20 | 1 | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è |

### –ü–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –°—Ç—Ä–æ–∫ | –ú–æ–¥—É–ª—å |
|---------|-------|--------|
| OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | 343 | oauth_yandex |
| API –∫–ª–∏–µ–Ω—Ç | 222 | api_client.py |
| –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ | 222 | device_transformer.py |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ | 441 | command_handler.py |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ | 215 | device_status.py |
| –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | 102 | device_sync.py |
| –û—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞–≥–∏–Ω | 178 | plugin.py |

---

## üîÑ –°–æ–±—ã—Ç–∏—è –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

### –ü—É–±–ª–∏–∫—É–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è

1. **`external.device_discovered`**
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `yandex_smart_home` (DeviceSync)
   - Payload: `{provider, external_id, type, capabilities, state}`
   - –ü–æ–¥–ø–∏—Å—á–∏–∫: `DevicesModule.handle_external_device_discovered()`
   - –î–µ–π—Å—Ç–≤–∏–µ: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `devices_external`

2. **`external.device_state_reported`**
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `yandex_smart_home` (CommandHandler)
   - Payload: `{external_id, state}`
   - –ü–æ–¥–ø–∏—Å—á–∏–∫: `DevicesModule.handle_external_state()`
   - –î–µ–π—Å—Ç–≤–∏–µ: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

3. **`internal.device_command_requested`**
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `DevicesModule` (devices.set_state)
   - Payload: `{internal_id, external_id, command, params}`
   - –ü–æ–¥–ø–∏—Å—á–∏–∫: `yandex_smart_home` (CommandHandler)
   - –î–µ–π—Å—Ç–≤–∏–µ: –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –≤ –Ø–Ω–¥–µ–∫—Å API

4. **`internal.device_state_updated`**
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `DevicesModule` (handle_external_state)
   - Payload: `{internal_id, external_id, old_state, new_state}`
   - –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: (–¥–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä automation)

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

- **oauth_yandex**: –¢–æ–ª—å–∫–æ OAuth, –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- **yandex_smart_home**: –¢–æ–ª—å–∫–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å
- **DevicesModule**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (–ª—é–±–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä)
- **AdminModule**: HTTP endpoints –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤

### 2. Event-Driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- –í—Å–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ Event Bus
- –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

### 3. Storage –∫–∞–∫ –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

- –¢–æ–∫–µ–Ω—ã: `storage["oauth_yandex"]["tokens"]`
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: `storage["devices"]`
- –í–Ω–µ—à–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: `storage["devices_external"]`
- –ú–∞–ø–ø–∏–Ω–≥–∏: `storage["devices_mappings"]`

### 4. –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

- –ö–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- UI –ø–æ–ª—É—á–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
- Background polling –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ TODO

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **OAuth**:
   - ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ refresh token (–Ω–∏ –≤ –æ–¥–Ω–æ–º OAuth –ø–ª–∞–≥–∏–Ω–µ)
   - ‚ùå –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞ (–µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π "–í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º expires_in –∏ –¥–µ–ª–∞–µ–º refresh")
   - ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
   - ‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: Refresh token —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã (`modules/api/auth/jwt_tokens.py`), –Ω–æ –ù–ï –¥–ª—è OAuth —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (–Ø–Ω–¥–µ–∫—Å, –∏ —Ç.–¥.)

2. **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**:
   - ‚ùå –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–ª—å–∫–æ `on_off` –∏ `brightness`
   - ‚ùå –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥—Ä—É–≥–∏—Ö capabilities (temperature, color_setting, etc.)
   - ‚ùå –ù–µ—Ç retry –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
   - ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É)

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**:
   - ‚ùå –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ê–ª–∏—Å–æ–π
   - ‚ùå –ù–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —á–µ—Ä–µ–∑ –ê–ª–∏—Å—É
   - ‚ùå –ù–µ—Ç webhook'–æ–≤ –æ—Ç –Ø–Ω–¥–µ–∫—Å–∞

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**:
   - ‚úÖ –î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
   - ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ rate limiting
   - ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

2. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
   - ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö capabilities –Ø–Ω–¥–µ–∫—Å API
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
   - ‚úÖ Webhook'–∏ –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

3. **UX**:
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh token
   - ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç —á–µ—Ä–µ–∑ `logger.log`:
- –£—Ä–æ–≤–Ω–∏: `debug`, `info`, `warning`, `error`
- –ö–æ–Ω—Ç–µ–∫—Å—Ç: `plugin`, `context` (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

1. **OAuth**:
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–π
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –æ–±–º–µ–Ω–∞ –∫–æ–¥–∞
   - –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤

2. **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**:
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤
   - –í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ API

3. **–ö–æ–º–∞–Ω–¥—ã**:
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
   - –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ pending —Å–æ—Å—Ç–æ—è–Ω–∏–π

---

## üîç –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –í–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

- `aiohttp` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –Ø–Ω–¥–µ–∫—Å API
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Python (asyncio, time, typing)

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `core.base_plugin` - –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –ø–ª–∞–≥–∏–Ω–∞
- `core.runtime` - CoreRuntime
- `core.service_registry` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- `core.event_bus` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
- `core.storage` - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `core.http_registry` - HTTP endpoints

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –ø–ª–∞–≥–∏–Ω–∞–º–∏

- `yandex_smart_home` ‚Üí `oauth_yandex` (–ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤)

---

## üéì –í—ã–≤–æ–¥—ã

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

1. ‚úÖ **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
2. ‚úÖ **Event-driven** - —Å–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Ç–æ–∫–µ–Ω—ã –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ HTTP
4. ‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
5. ‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** - –∫–æ–¥ —Ä–∞–∑–±–∏—Ç –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏

### –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

1. ‚ö†Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –¥–æ–±–∞–≤–∏—Ç—å retry –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
2. ‚ö†Ô∏è **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É capabilities
3. ‚ö†Ô∏è **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh token –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
4. ‚ö†Ô∏è **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–ª–µ—Ä—Ç—ã

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh token –≤ `oauth_yandex`
2. –î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º –≤ `YandexAPIClient`
3. –†–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É capabilities –≤ `DeviceTransformer`
4. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —É—Å—Ç—Ä–æ–π—Å—Ç–≤
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å webhook'–∏ –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 2025-01-XX  
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã**: 0.1.0  
**–ê–Ω–∞–ª–∏—Ç–∏–∫**: AI Assistant
