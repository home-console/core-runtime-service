# Безопасность административной панели

## Обзор

Административная панель (`/admin/*`) защищена на уровне сети и доступна только из приватных сетей.

## Требования к доступу

Админ-панель доступна **только** если запрос приходит:

1. **С localhost** (`127.0.0.1`, `::1`)
2. **Из приватной сети** (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16)
3. **Через VPN** (если VPN использует приватные IP адреса)

## Блокировка публичного доступа

Все запросы к `/admin/*` endpoints из публичного интернета автоматически блокируются с кодом **403 Forbidden**.

### Как это работает

1. **Admin Access Middleware** проверяет IP адрес клиента перед обработкой запроса
2. Если IP не является приватным (localhost или private network), запрос блокируется
3. Проверка выполняется **ДО** проверки авторизации, что предотвращает раскрытие информации о существовании админ-панели

### Определение IP адреса

Middleware учитывает заголовки прокси:
- `X-Forwarded-For` (берётся первый IP из списка)
- `X-Real-IP`
- IP из `request.client.host` (fallback)

## Безопасность

### Защита от:
- ✅ Прямого доступа из публичного интернета
- ✅ Сканирования портов и обнаружения админ-панели
- ✅ Атак на админ-панель извне

### Не защищает от:
- ⚠️ Атак из локальной сети (если злоумышленник в той же приватной сети)
- ⚠️ Компрометации VPN (если VPN скомпрометирован)

**Рекомендация:** Используйте VPN с дополнительной аутентификацией и шифрованием для доступа к админ-панели.

## Конфигурация

По умолчанию проверяются только приватные IP адреса. Дополнительная конфигурация (whitelist IP) может быть добавлена в будущем при необходимости.

## Примеры

### ✅ Разрешённый доступ:
- `http://localhost:8000/admin/v1/runtime` - localhost
- `http://192.168.1.100:8000/admin/v1/runtime` - приватная сеть
- `http://10.0.0.5:8000/admin/v1/runtime` - VPN с приватным IP

### ❌ Заблокированный доступ:
- `http://203.0.113.1:8000/admin/v1/runtime` - публичный IP
- `http://example.com:8000/admin/v1/runtime` - публичный домен

## Сообщения об ошибках

При попытке доступа из публичного интернета возвращается:

```json
{
  "detail": "Access denied: admin panel is only available from localhost or private network (VPN required)"
}
```

HTTP статус: **403 Forbidden**
