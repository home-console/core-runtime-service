# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: yandex_smart_home_real_v0 Plugin

## –°—Ç–∞—Ç—É—Å: ‚úì –ó–ê–í–ï–†–®–ï–ù–û

Real plugin –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ API –Ø–Ω–¥–µ–∫—Å–∞ –≤ Home Console –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –û—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞–≥–∏–Ω `yandex_smart_home_real.py`

**–ö–ª–∞—Å—Å:** `YandexSmartHomeRealPlugin`

**–°–µ—Ä–≤–∏—Å:** `yandex.sync_devices()`

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API –Ø–Ω–¥–µ–∫—Å–∞
- ‚úÖ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è `external.device_discovered` —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- ‚úÖ Plugin-first, in-process
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ `oauth_yandex.get_tokens()`
- ‚úÖ –ù–ï —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–∫–µ–Ω—ã
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ stub-–ø–ª–∞–≥–∏–Ω–æ–º

### 2. Smoke-—Ç–µ—Å—Ç `smoke_real_yandex_sync.py`

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:**
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–≥–∏–Ω–∞
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ Mock oauth_yandex.get_tokens
- ‚úÖ Mock API –Ø–Ω–¥–µ–∫—Å–∞
- ‚úÖ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ stub-–ø–ª–∞–≥–∏–Ω–æ–º

**–ó–∞–ø—É—Å–∫:**
```bash
cd core-runtime-service
python smoke_real_yandex_sync.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úì sync_devices returned 3 devices
‚úì 3 events received
‚úì All devices have required fields
‚úì Format is identical to stub-plugin
‚úì All assertions passed!
```

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### `plugins/YANDEX_REAL_README.md`
- –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞
- API –∏ —Å–µ—Ä–≤–∏—Å—ã
- –°–æ–±—ã—Ç–∏—è
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –û—Ç–ª–∞–¥–∫–∞

#### `plugins/STUB_VS_REAL.md`
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ stub vs real
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è
- API –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å
- –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### `YANDEX_REAL_INTEGRATION.md`
- –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- OAuth flow
- –ü–æ–ª—É—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
- UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. Plugin-first

Real plugin ‚Äî —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ service_registry –∏ event_bus.

```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ service_registry
tokens = await runtime.service_registry.call("oauth_yandex.get_tokens")

# –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ event_bus
await runtime.event_bus.publish("external.device_discovered", payload)
```

### 2. In-process

–ü–ª–∞–≥–∏–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ç–æ–º –∂–µ –ø—Ä–æ—Ü–µ—Å—Å–µ, —á—Ç–æ –∏ runtime, –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

### 3. Event-driven

–í—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–ª–µ–¥—É—é—Ç –æ–¥–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É, –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–º—É stub-–ø–ª–∞–≥–∏–Ω—É:

```python
{
    "provider": "yandex",
    "external_id": "<id –∏–∑ –Ø–Ω–¥–µ–∫—Å–∞>",
    "type": "<light|switch|sensor|...>",
    "capabilities": ["on_off", "brightness", ...],
    "state": { ... }
}
```

### 4. Stateless

Real plugin –ù–ï —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ‚úÖ –ù–µ —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–∫–µ–Ω—ã (–±–µ—Ä—ë—Ç –∏–∑ oauth_yandex)
- ‚úÖ –ù–µ —Ö—Ä–∞–Ω–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (—Ç–æ–ª—å–∫–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏ –ø—É–±–ª–∏–∫—É–µ—Ç)
- ‚úÖ –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–∞–ø–ø–∏–Ω–≥ external ‚Üí internal
- ‚úÖ –ù–µ –≤–µ–¥—ë—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π

### 5. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

Real plugin 100% —Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ stub-–ø–ª–∞–≥–∏–Ω–æ–º:

| –ê—Å–ø–µ–∫—Ç | Stub | Real |
|--------|------|------|
| –°–µ—Ä–≤–∏—Å | `yandex.sync_devices()` | `yandex.sync_devices()` |
| –°–æ–±—ã—Ç–∏–µ | `external.device_discovered` | `external.device_discovered` |
| –§–æ—Ä–º–∞—Ç | –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–π | –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–π |
| –î—Ä—É–≥–∏–µ –ø–ª–∞–≥–∏–Ω—ã | –ù–µ –∑–∞–º–µ—á–∞—é—Ç —Ä–∞–∑–Ω–∏—Ü—ã | –ù–µ –∑–∞–º–µ—á–∞—é—Ç —Ä–∞–∑–Ω–∏—Ü—ã |

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Real Plugin         ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ oauth_yandex.get_tokens()
‚îÇ         ‚Üì           ‚îÇ
‚îÇ access_token        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
GET https://api.iot.yandex.net/v1.0/user/devices
Authorization: Bearer <access_token>
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –Ø–Ω–¥–µ–∫—Å API          ‚îÇ
‚îÇ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
         ‚Üì
–ü—É–±–ª–∏–∫–∞—Ü–∏—è external.device_discovered
         ‚Üì
devices_plugin —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
```

### –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è

Real plugin –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ—Ç–≤–µ—Ç API –Ø–Ω–¥–µ–∫—Å–∞ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:

```python
# –Ø–Ω–¥–µ–∫—Å API
{
    "id": "yandex-light-kitchen",
    "type": "devices.types.light",
    "capabilities": [
        {
            "type": "devices.capabilities.on_off",
            ...
        }
    ],
    "states": [
        {
            "type": "devices.capabilities.on_off",
            "state": {"value": true}
        }
    ]
}

# ‚Üì –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
{
    "provider": "yandex",
    "external_id": "yandex-light-kitchen",
    "type": "light",
    "capabilities": ["on_off"],
    "state": {"on": true}
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

Real plugin –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –æ—à–∏–±–∫–∏:

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|---------|
| `ValueError: –¢–æ–∫–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã` | oauth_yandex.get_tokens() –≤–µ—Ä–Ω—É–ª None | –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º |
| `RuntimeError: –û—à–∏–±–∫–∞ –Ø–Ω–¥–µ–∫—Å API: HTTP 401` | –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π | –ü–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å |
| `RuntimeError: –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ` | –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–∑–∂–µ |
| `RuntimeError: –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å aiohttp` | aiohttp –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | `pip install aiohttp` |

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

–ï—Å–ª–∏ –≤ `console.py` –≤–∫–ª—é—á–µ–Ω auto-load, real plugin –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```python
# console.py
async def _auto_load_plugins(runtime: CoreRuntime) -> None:
    """–ê–≤—Ç–æ—Å–∫–∞–Ω plugins/ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö BasePlugin-–∫–ª–∞—Å—Å–æ–≤."""
    plugins_dir = Path(__file__).parent / "plugins"
    
    for _finder, mod_name, _ispkg in pkgutil.iter_modules([str(plugins_dir)]):
        module_name = f"plugins.{mod_name}"
        try:
            module = importlib.import_module(module_name)
            for _name, obj in inspect.getmembers(module, inspect.isclass):
                if issubclass(obj, BasePlugin) and obj is not BasePlugin:
                    plugin_instance = obj(runtime)
                    await runtime.plugin_manager.load_plugin(plugin_instance)
        except Exception:
            continue

# ‚Üê Automatically loads YandexSmartHomeRealPlugin
```

### Manual –∑–∞–ø—É—Å–∫

```python
from plugins.yandex_smart_home_real import YandexSmartHomeRealPlugin

# –°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å
plugin = YandexSmartHomeRealPlugin(runtime)
await runtime.plugin_manager.load_plugin(plugin)
await runtime.plugin_manager.start_plugin("yandex_smart_home_real")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
devices = await runtime.service_registry.call("yandex.sync_devices")
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Smoke-—Ç–µ—Å—Ç—ã

**–î–ª—è stub:**
```bash
python smoke_yandex_sync.py
```

**–î–ª—è real:**
```bash
python smoke_real_yandex_sync.py
```

### Unit-—Ç–µ—Å—Ç—ã

Real plugin —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è —Å mock-–¥–∞–Ω–Ω—ã–º–∏, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ API –Ø–Ω–¥–µ–∫—Å–∞.

```python
# –ü—Ä–∏–º–µ—Ä mock-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ smoke_real_yandex_sync.py
with patch("aiohttp.ClientSession") as mock_session_class:
    mock_session = MagicMock()
    mock_session_class.return_value.__aenter__ = AsyncMock(return_value=mock_session)
    mock_session.get = mock_aiohttp_get  # Mock –Ø–Ω–¥–µ–∫—Å API response
    
    devices = await runtime.service_registry.call("yandex.sync_devices")
    assert len(devices) == 3
    assert devices[0]["provider"] == "yandex"
```

## –§–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `plugins/yandex_smart_home_real.py` | –û—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞–≥–∏–Ω (300+ —Å—Ç—Ä–æ–∫) |
| `smoke_real_yandex_sync.py` | Smoke-—Ç–µ—Å—Ç (270+ —Å—Ç—Ä–æ–∫) |
| `plugins/YANDEX_REAL_README.md` | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞ |
| `plugins/STUB_VS_REAL.md` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä |
| `YANDEX_REAL_INTEGRATION.md` | –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ |

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### Core Runtime

- ‚úÖ No changes required to Core Runtime
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º plugin_manager
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º event_bus
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º service_registry

### –î—Ä—É–≥–∏–µ –ø–ª–∞–≥–∏–Ω—ã

- ‚úÖ devices_plugin ‚Äî –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ automation_plugin ‚Äî –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ oauth_yandex ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ system_logger_plugin ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### UI (admin-ui-service)

- ‚úÖ OAuthPage.tsx ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- ‚úÖ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í—Ä–µ–º–µ–Ω–∞ –æ—Ç–∫–ª–∏–∫–∞

- HTTP –∑–∞–ø—Ä–æ—Å –∫ API –Ø–Ω–¥–µ–∫—Å–∞: ~100-500ms
- –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è 3 —É—Å—Ç—Ä–æ–π—Å—Ç–≤: <10ms
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π: <1ms –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

Real plugin –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å:
- ‚úÖ 10-100 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥—Ä—É–≥–∏—Ö –ø–ª–∞–≥–∏–Ω–æ–≤
- ‚úÖ –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å sync_devices() –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤

- ‚úÖ –¢–æ–∫–µ–Ω—ã –ù–ï —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–ª–∞–≥–∏–Ω–µ
- ‚úÖ –¢–æ–∫–µ–Ω—ã –ù–ï –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –¢–æ–∫–µ–Ω—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ HTTPS-–∑–∞–ø—Ä–æ—Å–µ
- ‚úÖ access_token –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- ‚úÖ API –æ—à–∏–±–∫–∏ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–µ—Ç–∞–ª–∏
- ‚úÖ –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully
- ‚úÖ –ù–µ—Ç retry-–ª–æ–≥–∏–∫–∏ (–º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç)

## –ë—É–¥—É—â–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### Real Plugin v1

–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (set_device_state)
- [ ] Refresh token
- [ ] Polling / Webhook support
- [ ] History of syncs
- [ ] Caching

### Alice Integration

–û—Ç–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–≥–∏–Ω –¥–ª—è:
- [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ê–ª–∏—Å–æ–π
- [ ] Voice commands
- [ ] Integration with automation

### UI Extensions

- [ ] Dashboard –¥–ª—è –≤—ã–±–æ—Ä–∞ stub/real
- [ ] Show sync status
- [ ] Show device count
- [ ] Manual refresh button

## –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ production

- [x] –ü–ª–∞–≥–∏–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [x] API –∏–¥–µ–Ω—Ç–∏—á–µ–Ω stub
- [x] –°–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –ø–ª–∞–≥–∏–Ω–∞–º–∏
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] Load testing (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- [ ] Integration testing —Å —Ä–µ–∞–ª—å–Ω—ã–º API (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Real plugin `yandex_smart_home_real_v0` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**–ö–ª—é—á–µ–≤—ã–µ —á–µ—Ä—Ç—ã:**
- ‚úÖ Plugin-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ stub
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ Smoke-—Ç–µ—Å—Ç—ã
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ production

**–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ real –ø–ª–∞–≥–∏–Ω:**

```python
# –ë—ã–ª–æ (stub)
from plugins.yandex_smart_home_stub import YandexSmartHomeStubPlugin
plugin = YandexSmartHomeStubPlugin(runtime)

# –°—Ç–∞–ª–æ (real)
from plugins.yandex_smart_home_real import YandexSmartHomeRealPlugin
plugin = YandexSmartHomeRealPlugin(runtime)

# –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π!
```

Enjoy! üöÄ
