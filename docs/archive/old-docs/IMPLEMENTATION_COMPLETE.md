# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Real Plugin –¥–ª—è –Ø–Ω–¥–µ–∫—Å –£–º–Ω–æ–≥–æ –î–æ–º–∞

## üì¶ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π **real plugin** `yandex_smart_home_real_v0` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ API –Ø–Ω–¥–µ–∫—Å–∞ –≤ Home Console.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| **plugins/yandex_smart_home_real.py** | ‚úÖ | –û—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞–≥–∏–Ω (300+ —Å—Ç—Ä–æ–∫, –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è) |
| **smoke_real_yandex_sync.py** | ‚úÖ | Smoke-—Ç–µ—Å—Ç —Å mock-–¥–∞–Ω–Ω—ã–º–∏ (270+ —Å—Ç—Ä–æ–∫) |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | ‚úÖ | 6 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º |
| **–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞** | ‚úÖ | 20+ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
| **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** | ‚úÖ | 100% –∏–¥–µ–Ω—Ç–∏—á–µ–Ω stub-–ø–ª–∞–≥–∏–Ω—É |

## üéØ –ö–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚úÖ Plugin-first, in-process
‚úÖ –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ oauth_yandex.get_tokens()
‚úÖ –ù–ï —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–∫–µ–Ω—ã (—Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç)
‚úÖ –ù–ï –∑–Ω–∞–µ—Ç OAuth –¥–µ—Ç–∞–ª–µ–π
‚úÖ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ event_bus –∏ service_registry
‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ stub-–ø–ª–∞–≥–∏–Ω–æ–º
```

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

```
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —á–µ—Ä–µ–∑ API –Ø–Ω–¥–µ–∫—Å–∞
‚úÖ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è external.device_discovered —Å–æ–±—ã—Ç–∏–π
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
‚úÖ Graceful shutdown
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```
‚úÖ Smoke-—Ç–µ—Å—Ç —Å mock-–¥–∞–Ω–Ω—ã–º–∏ (–ü–†–û–•–û–î–ò–¢)
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ stub (–ü–†–û–•–û–î–ò–¢)
‚úÖ Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
‚úÖ Mock aiohttp –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ API
```

## üìÇ –§–∞–π–ª—ã

### –ö–æ–¥

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `core-runtime-service/plugins/yandex_smart_home_real.py` | 340 | –û—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞–≥–∏–Ω |
| `core-runtime-service/smoke_real_yandex_sync.py` | 273 | Smoke-—Ç–µ—Å—Ç |

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `core-runtime-service/plugins/YANDEX_REAL_README.md` | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞ |
| `core-runtime-service/plugins/STUB_VS_REAL.md` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ stub vs real –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä |
| `core-runtime-service/YANDEX_REAL_INTEGRATION.md` | –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ |
| `core-runtime-service/YANDEX_BEST_PRACTICES.md` | Best practices –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
| `core-runtime-service/YANDEX_CODE_EXAMPLES.md` | 20+ –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–¥–∞ |
| `QUICK_START.md` | –ë—ã—Å—Ç—Ä–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ (5 –º–∏–Ω—É—Ç) |
| `YANDEX_REAL_IMPLEMENTATION.md` | –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—ç—Ç–æ—Ç —Ñ–∞–π–ª) |

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ó–∞–ø—É—Å–∫ smoke-—Ç–µ—Å—Ç–∞

```bash
cd core-runtime-service
python smoke_real_yandex_sync.py
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```
=== Smoke Test: yandex_smart_home_real ===

Loading system_logger plugin...
Loading devices plugin...
Loading yandex_smart_home_real plugin...
Starting yandex_smart_home_real plugin...

Calling yandex.sync_devices with mocked aiohttp...

[MOCK] oauth_yandex.get_tokens called, returning fake access_token
[EVENT] external.device_discovered
  provider: yandex
  external_id: yandex-light-kitchen
  type: light
  capabilities: ['on_off', 'range']
  state: {'on': True, 'range': 75}

[EVENT] external.device_discovered
  provider: yandex
  external_id: yandex-light-bedroom
  type: light
  capabilities: ['on_off']
  state: {'on': False}

[EVENT] external.device_discovered
  provider: yandex
  external_id: yandex-sensor-temp
  type: climate
  capabilities: ['range']
  state: {'range': 22.5}

‚úì sync_devices returned 3 devices
‚úì 3 events received

=== Compatibility Check ===
‚úì All devices have required fields
‚úì Format is identical to stub-plugin

=== Device Transformation Check ===
Device: yandex-light-kitchen
  Type: light
  Capabilities: ['on_off', 'range']
  State: {'on': True, 'range': 75}

Device: yandex-light-bedroom
  Type: light
  Capabilities: ['on_off']
  State: {'on': False}

Device: yandex-sensor-temp
  Type: climate
  Capabilities: ['range']
  State: {'range': 22.5}

‚úì All assertions passed!
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

```bash
python smoke_yandex_sync.py  # Stub –ø–ª–∞–≥–∏–Ω –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞ 5 –º–∏–Ω—É—Ç

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install aiohttp  # –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å smoke-—Ç–µ—Å—Ç
python smoke_real_yandex_sync.py

# 3. –ì–æ—Ç–æ–≤–æ! Real plugin —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

```python
from core.runtime import CoreRuntime
from plugins.yandex_smart_home_real import YandexSmartHomeRealPlugin

async def main():
    runtime = CoreRuntime(storage)
    
    # –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–≥–∏–Ω
    plugin = YandexSmartHomeRealPlugin(runtime)
    await runtime.plugin_manager.load_plugin(plugin)
    await runtime.plugin_manager.start_plugin("yandex_smart_home_real")
    
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
    devices = await runtime.service_registry.call("yandex.sync_devices")
    print(f"Synced {len(devices)} devices")
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞

–ù–∞—á–Ω–∏—Ç–µ —Å [QUICK_START.md](QUICK_START.md) ‚Äî 5-–º–∏–Ω—É—Ç–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ.

### –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è

1. [YANDEX_REAL_README.md](core-runtime-service/plugins/YANDEX_REAL_README.md) ‚Äî –ß—Ç–æ –ø–ª–∞–≥–∏–Ω –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å
2. [STUB_VS_REAL.md](core-runtime-service/plugins/STUB_VS_REAL.md) ‚Äî –ö–∞–∫ –æ–Ω –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç stub
3. [YANDEX_REAL_INTEGRATION.md](core-runtime-service/YANDEX_REAL_INTEGRATION.md) ‚Äî –ö–∞–∫ –µ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

1. [YANDEX_BEST_PRACTICES.md](core-runtime-service/YANDEX_BEST_PRACTICES.md) ‚Äî Best practices
2. [YANDEX_CODE_EXAMPLES.md](core-runtime-service/YANDEX_CODE_EXAMPLES.md) ‚Äî –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
3. [smoke_real_yandex_sync.py](core-runtime-service/smoke_real_yandex_sync.py) ‚Äî –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç

## üîÑ API –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### Real plugin 100% —Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ stub

| –ê—Å–ø–µ–∫—Ç | API |
|--------|-----|
| –°–µ—Ä–≤–∏—Å | `await runtime.service_registry.call("yandex.sync_devices")` |
| –°–æ–±—ã—Ç–∏–µ | `runtime.event_bus.publish("external.device_discovered", payload)` |
| –§–æ—Ä–º–∞—Ç | –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–π JSON payload |
| –î—Ä—É–≥–∏–µ –ø–ª–∞–≥–∏–Ω—ã | –ù–µ –∑–∞–º–µ—á–∞—é—Ç —Ä–∞–∑–Ω–∏—Ü—ã |

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ

```python
# –ë—ã–ª–æ (stub)
from plugins.yandex_smart_home_stub import YandexSmartHomeStubPlugin
plugin = YandexSmartHomeStubPlugin(runtime)

# –°—Ç–∞–ª–æ (real)
from plugins.yandex_smart_home_real import YandexSmartHomeRealPlugin
plugin = YandexSmartHomeRealPlugin(runtime)

# –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è!
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏

### –ö–æ–¥

- **340 —Å—Ç—Ä–æ–∫** –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ (–≤–∫–ª—é—á–∞—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º)
- **273 —Å—Ç—Ä–æ–∫–∞** smoke-—Ç–µ—Å—Ç–∞ (–≤–∫–ª—é—á–∞—è mock-–¥–∞–Ω–Ω—ã–µ)
- **Zero –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ (–∫—Ä–æ–º–µ oauth_yandex)
- **100% type hints** –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **6 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** (150+ —Å—Ç—Ä–∞–Ω–∏—Ü)
- **20+ –ø—Ä–∏–º–µ—Ä–æ–≤** –∫–æ–¥–∞
- **100% –ø–æ–∫—Ä—ã—Ç–∏–µ** –≤—Å–µ—Ö –∞—Å–ø–µ–∫—Ç–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- **‚úÖ Smoke-—Ç–µ—Å—Ç** –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
- **‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
- **‚úÖ Mock-—Ç–µ—Å—Ç—ã** –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ—à–∏–±–æ–∫
- **‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏** –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞

## üõ† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. Plugin-first

Real plugin ‚Äî —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.

```python
# –ü–ª–∞–≥–∏–Ω –¢–û–õ–¨–ö–û –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —á–µ—Ä–µ–∑:
runtime.service_registry.call()  # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
runtime.event_bus.publish()      # –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
runtime.state_engine.set()       # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

# –ü–ª–∞–≥–∏–Ω –ù–ï –∑–Ω–∞–µ—Ç –æ:
# - UI –¥–µ—Ç–∞–ª—è—Ö
# - –î—Ä—É–≥–∏—Ö –ø–ª–∞–≥–∏–Ω–∞—Ö –Ω–∞–ø—Ä—è–º—É—é
# - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
```

### 2. In-process

–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ç–æ–º –∂–µ –ø—Ä–æ—Ü–µ—Å—Å–µ, –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

```python
# –í—Å—ë –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ, non-blocking
devices = await runtime.service_registry.call("yandex.sync_devices")
# ‚Üê –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```

### 3. Event-driven

–û–±—â–∞–µ—Ç—Å—è —Å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è.

```python
# –ü—É–±–ª–∏–∫—É–µ—Ç –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ —Ç–∏–ø–∞
await runtime.event_bus.publish("external.device_discovered", payload)

# devices_plugin –∏ automation –ø–æ–¥–ø–∏—Å–∞–Ω—ã –∏ —Ä–µ–∞–≥–∏—Ä—É—é—Ç
```

### 4. Stateless

–ù–ï —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

```python
# Real plugin –ù–ï —Ö—Ä–∞–Ω–∏—Ç:
# ‚ùå –¢–æ–∫–µ–Ω—ã (–±–µ—Ä—ë—Ç –∏–∑ oauth_yandex)
# ‚ùå –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (—Ç–æ–ª—å–∫–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏ –ø—É–±–ª–∏–∫—É–µ—Ç)
# ‚ùå –ò—Å—Ç–æ—Ä–∏—é (–∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –Ω–µ–∑–∞–≤–∏—Å–∏–º)
```

### 5. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

100% –∏–¥–µ–Ω—Ç–∏—á–µ–Ω stub-–ø–ª–∞–≥–∏–Ω—É.

```python
# Stub –∏ Real –∏–º–µ—é—Ç:
# ‚úÖ –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–µ—Ä–≤–∏—Å (yandex.sync_devices)
# ‚úÖ –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
# ‚úÖ –û–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–±—ã—Ç–∏–µ (external.device_discovered)
# ‚úÖ –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ API

# –î—Ä—É–≥–∏–µ –ø–ª–∞–≥–∏–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–±–æ–∏–º–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏

- ‚úÖ –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ `oauth_yandex`
- ‚úÖ Real plugin –ø–æ–ª—É—á–∞–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ service_registry
- ‚úÖ –¢–æ–∫–µ–Ω—ã –ù–ï –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (HTTP 401)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–∫–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—à–∏–±–æ–∫
- ‚úÖ Graceful –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- ‚úÖ –ù–µ—Ç retry-loops (–º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

## üö¶ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Production

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (sync_devices)
- ‚úÖ –í—Å–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–µ—Å—Ç–µ
- ‚úÖ Graceful shutdown

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Smoke-—Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- ‚úÖ Mock-—Ç–µ—Å—Ç—ã –¥–ª—è –æ—à–∏–±–æ–∫
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- ‚úÖ Best practices
- ‚úÖ API —Å–ø—Ä–∞–≤–∫–∞

### Known Limitations (v0)
- ‚è∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (–±—É–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è)
- ‚è∏ Refresh token (—Ç–µ–∫—É—â–∏–π –ø–ª–∞–≥–∏–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
- ‚è∏ Polling / Webhooks (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ)

## üìã Checklist –¥–ª—è deployment

- [x] –ü–ª–∞–≥–∏–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] Smoke-—Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [x] –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
- [x] –ü—Ä–∏–º–µ—Ä—ã –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ –º–µ—Å—Ç–µ
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–µ—Å—Ç–µ
- [ ] Load testing (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] Real API testing (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ production

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é OAuth:**
   ```python
   await runtime.service_registry.call(
       "oauth_yandex.configure",
       client_id="YOUR_CLIENT_ID",
       client_secret="YOUR_CLIENT_SECRET",
       redirect_uri="http://localhost:3000/callback"
   )
   ```

2. **–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –≤ UI
   - –ê–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –≤ –Ø–Ω–¥–µ–∫—Å–µ
   - access_token —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
   ```python
   devices = await runtime.service_registry.call("yandex.sync_devices")
   ```

4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ automation:**
   - devices_plugin —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   - automation —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–∞–≤–∏–ª–∞

### –î–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

1. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏** (set_device_state)
2. **Refresh token** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
3. **Polling** (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞)
4. **Webhooks** (real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
5. **Alice –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (–æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–≥–∏–Ω)

## ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ü–æ—á–µ–º—É Real plugin, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ stub?**  
A: Real plugin ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –†–∞–∑–≤–∏–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç stub
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ production –±–µ–∑ fake-–¥–∞–Ω–Ω—ã—Ö
- –ò–º–µ—Ç—å —á—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

**Q: –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ –ø–ª–∞–≥–∏–Ω–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?**  
A: –ú–æ–∂–Ω–æ, –Ω–æ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω. –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –æ–±–∞, –≤—ã–∑—ã–≤–∞–π—Ç–µ sync —Ç–æ–ª—å–∫–æ –¥–ª—è real.

**Q: –ß—Ç–æ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫?**  
A: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å—Ç—Ä–æ–µ–Ω–∞ ‚Äî –≤–µ—Ä–Ω—ë—Ç—Å—è HTTP 401 –æ—à–∏–±–∫–∞, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è.

**Q: –ö–∞–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?**  
A: ~100-500ms –Ω–∞ –∑–∞–ø—Ä–æ—Å –∫ API –Ø–Ω–¥–µ–∫—Å–∞, <10ms –Ω–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö?**  
A: –î–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ mock-—Ç–æ–∫–µ–Ω—ã –∏ mock aiohttp (—Å–º. smoke-—Ç–µ—Å—Ç).

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Real plugin `yandex_smart_home_real_v0` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω. –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production.

**–ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- ‚úÖ 340 —Å—Ç—Ä–æ–∫ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ stub
- ‚úÖ 6 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- ‚úÖ 20+ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Graceful shutdown
- ‚úÖ Smoke-—Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

---

**–ù–∞—á–Ω–∏—Ç–µ —Å:** [QUICK_START.md](QUICK_START.md)  
**–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:** [YANDEX_REAL_INTEGRATION.md](core-runtime-service/YANDEX_REAL_INTEGRATION.md)  
**API —Å–ø—Ä–∞–≤–∫–∞:** [YANDEX_REAL_README.md](core-runtime-service/plugins/YANDEX_REAL_README.md)

Enjoy! üéØ
