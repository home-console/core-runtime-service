# Admin UI — Информационная архитектура

## Цель админки

Admin UI — интерфейс для администраторов Home Console Runtime. Предназначен для инспекции состояния системы, управления конфигурацией, мониторинга доменных сущностей и контроля доступа. Админка отражает архитектуру системы: разделение на runtime-метаданные, конфигурацию, доменную логику и безопасность.

## Принципиальное разделение

Админка делится на четыре слоя, каждый из которых отвечает за отдельный аспект системы:

1. **System (Runtime)** — метаинформация о runtime, его структуре и текущем состоянии
2. **Configuration** — настройки системы, интеграции, persistent storage
3. **Domain** — доменные сущности и бизнес-логика
4. **Access & Security** — авторизация, управление пользователями, API keys, сессии

Разделение основано на природе данных и операций, а не на технической реализации.

## 1. System (Runtime)

**Назначение слоя**: Инспекция метаинформации о runtime. Пользователь понимает структуру системы: какие плагины загружены, какие сервисы зарегистрированы, какие HTTP endpoints доступны, как устроена система событий, каково текущее состояние runtime state engine.

**Существующие страницы**:
- **SystemPage** — базовая информация о runtime (version, started_at, uptime)
- **PluginsPage** — список плагинов с метаданными (loaded, started, services_count, http_count, event_subscriptions)
- **ServicesPage** — список сервисов, сгруппированных по плагинам
- **EventsPage** — события и их подписчики (event_name, subscribers)
- **StateInspector** — инспектор runtime state engine (keys, values, dump all)
- **AdminDashboard** — агрегированный обзор (plugins, services, http endpoints, state keys)

**Что пользователь здесь понимает**: Структуру runtime, его компоненты, связи между ними. Это метаданные, которые не меняются без перезагрузки системы (кроме state engine, который может изменяться в runtime).

**Ключевые характеристики**:
- Данные отражают структуру системы, а не её поведение
- Изменения требуют перезагрузки runtime (кроме state engine)
- Это инспекция, а не управление

## 2. Configuration

**Назначение слоя**: Управление настройками системы и интеграций. Пользователь настраивает параметры, которые влияют на поведение системы, но не являются частью доменной логики.

**Существующие страницы**:
- **OAuthPage** — конфигурация OAuth интеграции (Yandex Smart Home): настройка credentials, авторизация, управление токенами
- **StoragePage** — просмотр persistent storage namespaces и количества ключей

**Что пользователь здесь понимает**: Параметры конфигурации, настройки интеграций, структуру persistent storage. Изменения конфигурации влияют на поведение системы, но не требуют перезагрузки runtime (для OAuth) или требуют (для некоторых других настроек).

**Ключевые характеристики**:
- Данные персистентны (сохраняются между перезапусками)
- Изменения влияют на поведение системы
- Это управление настройками, а не инспекция

**Примечание**: Storage показывает структуру persistent storage, но не содержимое. Это метаинформация о конфигурации и данных, хранящихся в storage.

## 3. Domain

**Назначение слоя**: Управление доменными сущностями и бизнес-логикой. Пользователь работает с сущностями предметной области: устройства, маппинги, автоматизация.

**Существующие страницы**:
- **DevicesPage** — просмотр внутренних и внешних устройств (internal devices, external devices от провайдеров)
- **MappingPage** — управление маппингами между внешними и внутренними устройствами (create, delete, auto-map)
- **Automation** — заглушка (не реализовано)

**Что пользователь здесь понимает**: Доменные сущности, их состояние, связи между ними. Это бизнес-логика системы, которая может изменяться в runtime без перезагрузки.

**Ключевые характеристики**:
- Данные отражают предметную область
- Изменения происходят в runtime
- Это управление доменными сущностями, а не метаданными

**Примечание**: OAuthPage частично показывает devices и mappings, но это побочный эффект OAuth flow (для настройки маппинга в процессе авторизации). Основное управление devices и mappings происходит в Domain слое.

## 4. Access & Security

**Назначение слоя**: Управление доступом и безопасностью. Пользователь контролирует авторизацию, управляет пользователями, API keys, сессиями.

**Существующие страницы**:
- **LoginPage** — вход в систему (авторизация через user_id и password)

**Что пользователь здесь понимает**: Механизмы доступа, права пользователей, сессии, API keys. Это инфраструктура безопасности, которая контролирует доступ к остальным слоям.

**Ключевые характеристики**:
- Данные критичны для безопасности
- Изменения влияют на доступ к системе
- Это управление доступом, а не доменная логика

**Примечание**: Backend предоставляет endpoints для управления API keys, пользователями, сессиями, паролями, но они не реализованы в UI. Эти endpoints относятся к Access & Security слою.

## Что НЕ ЯВЛЯЕТСЯ отдельным слоем

### Dashboard

**AdminDashboard** не является отдельным слоем. Это агрегированный обзор, который показывает данные из System (Runtime) слоя: plugins, services, http endpoints, state keys. Dashboard — это представление метаинформации о runtime, а не самостоятельная доменная область.

### State и Storage

**State Inspector** и **StoragePage** — разные сущности, относящиеся к разным слоям:

- **State Inspector** (System/Runtime) — инспектор runtime state engine. Это in-memory состояние, которое существует только во время работы runtime. Может изменяться в runtime, но не персистентно.

- **StoragePage** (Configuration) — метаинформация о persistent storage. Это персистентное хранилище, которое сохраняется между перезапусками. Storage содержит конфигурацию и данные, которые должны пережить перезапуск runtime.

Различие: State — это runtime state (живое состояние), Storage — это persistent storage (персистентное хранилище).

### OAuth и Devices

**OAuthPage** и **DevicesPage/MappingPage** — разные сущности, относящиеся к разным слоям:

- **OAuthPage** (Configuration) — настройка OAuth интеграции. Это конфигурация внешнего сервиса (Yandex), управление credentials, токенами, авторизацией.

- **DevicesPage/MappingPage** (Domain) — управление устройствами и маппингами. Это доменные сущности, которые существуют независимо от OAuth.

OAuthPage показывает devices и mappings как часть OAuth flow (для настройки маппинга в процессе авторизации), но основное управление devices происходит в Domain слое. OAuth — это способ получения внешних устройств, а не способ управления устройствами.

## Ключевые архитектурные правила

1. **Admin UI отражает архитектуру системы, а не наоборот**. Структура админки следует за разделением на System/Configuration/Domain/Access, которое существует в backend.

2. **System (Runtime) ≠ Domain**. Метаинформация о runtime (plugins, services, events) — это не доменная логика. Доменная логика (devices, automation) — это не метаинформация.

3. **Configuration ≠ State**. Конфигурация (настройки, интеграции) — это персистентные параметры. State (runtime state engine) — это in-memory состояние runtime.

4. **Storage ≠ State Engine**. Storage — это persistent storage (персистентное хранилище). State Engine — это runtime state (in-memory состояние). Они решают разные задачи.

5. **OAuth ≠ Devices**. OAuth — это конфигурация интеграции (Configuration). Devices — это доменные сущности (Domain). OAuth может быть источником внешних устройств, но не способом управления устройствами.

6. **Инспекция ≠ Управление**. System (Runtime) слой — это инспекция метаданных. Configuration и Domain слои — это управление настройками и сущностями.

7. **Метаданные статичны, доменные данные динамичны**. Метаинформация о runtime (plugins, services, events) не меняется без перезагрузки. Доменные сущности (devices, mappings) могут изменяться в runtime.

## Итог

Этот документ фиксирует информационную архитектуру Admin UI как смысловую модель системы. Он определяет четыре слоя (System/Configuration/Domain/Access) и правила их разделения. Документ служит опорой для понимания структуры админки и стабилизирует концептуальную модель, на основе которой можно принимать решения о размещении функциональности и организации навигации.
